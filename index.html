<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1.3.0/dist/aframe-master.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/geolib"></script>
</head>

<body style="margin: 0; overflow: hidden;">
    <a-scene renderer="logarithmicDepthBuffer: true;" embedded loading-screen="enabled: false;"
        arjs="sourceType: webcam; debugUIEnabled: false;">

        <a-assets>
            <a-asset-item id="animated-asset" src="assets/asset.glb"></a-asset-item>
            <a-asset-item id="animated-asset-1" src="assets/Arrow.glb"></a-asset-item>
        </a-assets>

        <a-entity look-at="[gps-camera]" animation-mixer="loop: repeat" gltf-model="#animated-asset-1" scale="2 2 2"
            gps-entity-place="latitude:11.3323995; longitude:77.7041484;">
            <a-text class="distance-text" value="Place Name 1" align="center" rotation="0 0 0" position="0 1 0" scale="1 1 1" color="#000"></a-text>
        </a-entity>

        <a-entity look-at="[gps-camera]" animation-mixer="loop: repeat" gltf-model="#animated-asset" scale="2 2 2"
            gps-entity-place="latitude:11.3324033; longitude:77.7039629;">
            <a-text class="distance-text" value="Place Name 2" align="center" position="0 1 0" scale="1 1 1" color="#000"></a-text>
        </a-entity>

        <a-camera id="gpsCamera" gps-camera="gpsMinDistance: 10; accelerationToMove: 1.0" rotation-reader></a-camera>
    </a-scene>

    <script>
        document.querySelector('a-scene').addEventListener('loaded', () => {
            const camera = document.getElementById('gpsCamera');

            camera.addEventListener('gps-camera-update-position', (e) => {
                alert('position update')
                const currentPos = {
                    latitude: e.detail.position.latitude,
                    longitude: e.detail.position.longitude
                };

                document.querySelectorAll('[gps-entity-place]').forEach(place => {
                    const placePos = {
                        latitude: place.getAttribute('gps-entity-place').latitude,
                        longitude: place.getAttribute('gps-entity-place').longitude
                    };

                    const distance = geolib.getDistance(currentPos, placePos);

                    const distanceText = place.querySelector('.distance-text');
                    distanceText.setAttribute('value', `Distance: ${distance} meters`);
                });
            });
        });
    </script>

</body>

</html>